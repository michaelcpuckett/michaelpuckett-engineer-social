<!doctype html>
<title>MealGenie</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/main.css" />
<div class="root">
  <h1>MealGenie</h1>
  <nav>
    <a class="back-button" href="/edit-profile/diet">
<svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4 12L20 12" stroke="#323232" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M10 6L4.0625 11.9375V11.9375C4.02798 11.972 4.02798 12.028 4.0625 12.0625V12.0625L10 18" stroke="#323232" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>Back</a>
  </nav>
  <hr />
<div class="section">
  <h2>
    Goals
  </h2>

  <div class="slider-container">
    <small>
      What are your dietary goals?
    </small>
    <form class="tabs-wrapper" id="goal-tabs">
      {% for goalByType in goalData %}
        <fieldset-wrapper id="goal-fieldset">
          <fieldset>
            {% for goal in goalByType.items %}
              <label>
                <input type="checkbox" name="goal" value="{{ goal.name }}" {% for d in profile.dietaryGoals | splitOnComma %}{% if (d | lower) == (goal.name | lower) %}checked{% endif %}{% endfor %} />
                <img src="/goal-images/{{ goal.imageUrl }}" aria-hidden="true" />
                <span>{{ goal.name }}</span>
              </label>
            {% endfor %}
          </fieldset>
        </fieldset-wrapper>
      {% endfor %}
    </form>
  </div>

  <script type="module">
    const goalFieldsetElement = window.document.querySelector('#goal-tabs');
    const checkboxElements = Array.from(goalFieldsetElement.querySelectorAll('[type="checkbox"]'));
    for (const checkboxElement of checkboxElements) {
      checkboxElement.addEventListener('change', () => {
        if (checkboxElement.checked) {
          const value = checkboxElement.value || '';
          const outputElement = window.document.querySelector('#goals');
          outputElement.textContent = `${outputElement.textContent ? `${outputElement.textContent}, ` : ''}${value}`;
          const listItemElement = window.document.createElement('li');
          listItemElement.dataset.goal = value;
          const valueTextNode = window.document.createTextNode(value);
          listItemElement.append(valueTextNode);
          const removeButtonElement = window.document.createElement('remove-button');
          listItemElement.append(removeButtonElement);
          outputElement.nextElementSibling.append(listItemElement);
        } else {
          const goal = checkboxElement.value || '';
          const outputElement = window.document.querySelector('#goals');
          const itemsArray = outputElement.textContent.split(', ');
          itemsArray.splice(itemsArray.indexOf(goal), 1);
          outputElement.textContent = itemsArray.join(', ');
          window.document.querySelector(`[data-goal="${goal}"]`).remove();
        }
      });
    }
  </script>
  
<form>
  <div class="autocomplete-container">
    <input type="tel" id="calorie-goal" placeholder="Daily calorie goal" />
    <button type="submit">
      Add Calorie Goal
    </button>
  </div>
</form>
<!--
<form>
  <div class="autocomplete-container">
    <input type="number" id="protein-goal" placeholder="Daily goal in grams" />
    <button type="submit">
      Add Protein Goal
    </button>
  </div>
</form>

<form>
  <div class="autocomplete-container">
    <input type="number" id="carbs-goal" placeholder="Daily goal in grams" />
    <button type="submit">
      Add Carbs Goal
    </button>
  </div>
</form>

<form>
  <div class="autocomplete-container">
    <input type="number" id="fat-goal" placeholder="Daily goal in grams" />
    <button type="submit">
      Add Fat Goal
    </button>
  </div>
</form>-->
    <script type="module">
      const favoritesListInputElement = window.document.querySelector('#goal');
      const datalistElement = favoritesListInputElement.nextElementSibling;
      const formElement = favoritesListInputElement.closest('form');

      formElement.addEventListener('submit', (event) => {
        event.preventDefault();
        const value = favoritesListInputElement.value || '';
        if (!value) {
          return;
        }
        const outputElement = window.document.querySelector('#goals');
        outputElement.textContent = `${outputElement.textContent ? `${outputElement.textContent}, ` : ''}${value}`;
        const listItemElement = window.document.createElement('li');
        listItemElement.dataset.goal = value;
        const valueTextNode = window.document.createTextNode(value);
        listItemElement.append(valueTextNode);
        const removeButtonElement = window.document.createElement('remove-button');
        listItemElement.append(removeButtonElement);
        outputElement.nextElementSibling.append(listItemElement);
        favoritesListInputElement.value = '';
        for (const item of Array.from(window.document.querySelectorAll('fieldset input'))) {
          if (item.parentElement.querySelector('span').textContent.toLowerCase() === value) {
            item.checked = true;
          }
        }
        for (const element of Array.from(datalistElement.children)) {
          element.remove();
        }
      });
    </script>
    
    <script type="module">
      const proteinGoalInputElement = window.document.querySelector('#protein-goal');
      const proteinGoalFormElement = proteinGoalInputElement.closest('form');

      proteinGoalFormElement.addEventListener('submit', (event) => {
        event.preventDefault();
        const value = `${proteinGoalInputElement.value || ''}g (Daily protein)`;
        const outputElement = window.document.querySelector('#goals');
        outputElement.textContent = `${outputElement.textContent ? `${outputElement.textContent}, ` : ''}${value}`;
        const listItemElement = window.document.createElement('li');
        listItemElement.dataset.goal = value;
        const valueTextNode = window.document.createTextNode(value);
        listItemElement.append(valueTextNode);
        const removeButtonElement = window.document.createElement('remove-button');
        listItemElement.append(removeButtonElement);
        outputElement.nextElementSibling.append(listItemElement);
        proteinGoalInputElement.value = '';
        for (const item of Array.from(window.document.querySelectorAll('fieldset input'))) {
          if (item.parentElement.querySelector('span').textContent.toLowerCase() === value) {
            item.checked = true;
          }
        }
      });
    </script>
    
    <script type="module">
      const carbsGoalInputElement = window.document.querySelector('#carbs-goal');
      const carbsGoalFormElement = carbsGoalInputElement.closest('form');

      carbsGoalFormElement.addEventListener('submit', (event) => {
        event.preventDefault();
        const value = `${carbsGoalInputElement.value || ''}g (Daily carbs)`;
        const outputElement = window.document.querySelector('#goals');
        outputElement.textContent = `${outputElement.textContent ? `${outputElement.textContent}, ` : ''}${value}`;
        const listItemElement = window.document.createElement('li');
        listItemElement.dataset.goal = value;
        const valueTextNode = window.document.createTextNode(value);
        listItemElement.append(valueTextNode);
        const removeButtonElement = window.document.createElement('remove-button');
        listItemElement.append(removeButtonElement);
        outputElement.nextElementSibling.append(listItemElement);
        carbsGoalInputElement.value = '';
        for (const item of Array.from(window.document.querySelectorAll('fieldset input'))) {
          if (item.parentElement.querySelector('span').textContent.toLowerCase() === value) {
            item.checked = true;
          }
        }
      });
    </script>
    
    <script type="module">
      const fatGoalInputElement = window.document.querySelector('#fat-goal');
      const fatGoalFormElement = fatGoalInputElement.closest('form');

      fatGoalFormElement.addEventListener('submit', (event) => {
        event.preventDefault();
        const value = `${fatGoalInputElement.value || ''}g (Daily fat)`;
        const outputElement = window.document.querySelector('#goals');
        outputElement.textContent = `${outputElement.textContent ? `${outputElement.textContent}, ` : ''}${value}`;
        const listItemElement = window.document.createElement('li');
        listItemElement.dataset.goal = value;
        const valueTextNode = window.document.createTextNode(value);
        listItemElement.append(valueTextNode);
        const removeButtonElement = window.document.createElement('remove-button');
        listItemElement.append(removeButtonElement);
        outputElement.nextElementSibling.append(listItemElement);
        fatGoalInputElement.value = '';
        for (const item of Array.from(window.document.querySelectorAll('fieldset input'))) {
          if (item.parentElement.querySelector('span').textContent.toLowerCase() === value) {
            item.checked = true;
          }
        }
      });
    </script>
    <script type="module">
      const calorieGoalInputElement = window.document.querySelector('#calorie-goal');
      const calorieGoalFormElement = calorieGoalInputElement.closest('form');

      calorieGoalFormElement.addEventListener('submit', (event) => {
        event.preventDefault();
        if (!calorieGoalInputElement.value) {
          return;
        }
        const value = `${calorieGoalInputElement.value || ''} (Daily calories)`;
        const outputElement = window.document.querySelector('#goals');
        outputElement.textContent = `${outputElement.textContent ? `${outputElement.textContent}, ` : ''}${value}`;
        const listItemElement = window.document.createElement('li');
        listItemElement.dataset.goal = value;
        const valueTextNode = window.document.createTextNode(value);
        listItemElement.append(valueTextNode);
        const removeButtonElement = window.document.createElement('remove-button');
        listItemElement.append(removeButtonElement);
        outputElement.nextElementSibling.append(listItemElement);
        calorieGoalInputElement.value = '';
        for (const item of Array.from(window.document.querySelectorAll('fieldset input'))) {
          if (item.parentElement.querySelector('span').textContent.toLowerCase() === value) {
            item.checked = true;
          }
        }
      });
    </script>
  <form id="edit-profile">
    <div class="fixed-cta">
      <button type="submit">
        Generate Meal Plan <svg fill="#000000" height="1em" width="1em" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
        viewBox="0 0 31.143 31.143" xml:space="preserve">
     <g>
       <g id="c100_arrow">
         <path d="M0,15.571c0.001,1.702,1.383,3.081,3.085,3.083l17.528-0.002l-4.738,4.739c-1.283,1.284-1.349,3.301-0.145,4.507
           c1.205,1.201,3.222,1.138,4.507-0.146l9.896-9.898c1.287-1.283,1.352-3.301,0.146-4.506c-0.033-0.029-0.068-0.051-0.1-0.08
           c-0.041-0.043-0.07-0.094-0.113-0.139l-9.764-9.762c-1.268-1.266-3.27-1.316-4.474-0.111c-1.205,1.205-1.153,3.208,0.111,4.476
           l4.755,4.754H3.085C1.381,12.485,0,13.865,0,15.571z"/>
       </g>
       <g id="Capa_1_46_">
       </g>
     </g>
     </svg>
      </button>
    </div>
    <label>
      <output hidden id="goals">{{ profile.dietaryGoals }}</output>
      <ul aria-label="Goal"><!--
        -->{% if profile.dietaryGoals %}
          {% for goal in profile.dietaryGoals.split(', ') %}
           <li data-goal="{{ goal }}">{{ goal }} <remove-button></remove-button></li>
          {% endfor %}
        {% endif %}<!--
      --></ul>
      <script type="module">
        const outputElement = window.document.querySelector('#goals');
        outputElement.nextElementSibling.addEventListener('click', (event) => {
          const buttonElement = event.target;
          const goal = Array.from(buttonElement.closest('li').childNodes).find(node => node.nodeType === Node.TEXT_NODE).textContent.trim();
          const itemsArray = outputElement.textContent.split(', ');
          itemsArray.splice(itemsArray.indexOf(goal), 1);
          outputElement.textContent = itemsArray.join(', ');
          buttonElement.closest('li').remove();
          for (const item of Array.from(window.document.querySelectorAll('fieldset input'))) {
            if (item.parentElement.querySelector('span').textContent.toLowerCase() === goal) {
              item.checked = false;
            }
          }

          window.document.querySelector(`[name="goal"][value="${goal}"]`).checked = false;
        });
      </script>
      <script type="module">
        window.customElements.define('remove-button', class RemoveButton extends HTMLElement {
          constructor() {
            super();
            this.attachShadow({ mode: 'open', });
            const stylesheet = new CSSStyleSheet();
            stylesheet.replaceSync(`
              button {
                color: white;
                background: red;
                border-radius: 100%;
              }
            `);
            this.shadowRoot.adoptedStyleSheets = [stylesheet];
            const buttonElement = window.document.createElement('button');
            buttonElement.setAttribute('type', 'button');
            buttonElement.textContent = 'X';
            this.shadowRoot.append(buttonElement);
          }
        });
      </script>
    </label>
    <p class="loader" hidden>Loading, please wait up to 2 minutes...</p>
  </form>
  <script type="module">
    window.document.querySelector('#edit-profile').addEventListener('submit', (event) => {
      event.preventDefault();

      window.document.querySelector('#edit-profile .loader').removeAttribute('hidden');

      const goal = window.document.querySelector('#goals');

      const profile = {
        dietaryGoals: goal.value,
      };

      fetch('/edit-profile/goals', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(profile),
      }).then((response) => {
        window.location = new URL('/edit-profile', window.location);
      });
    });
  </script>
</div>
</div>